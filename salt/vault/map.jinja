# -*- coding: utf-8 -*-

{% import_yaml "vault/maps/defaults.yaml" or {} as defaults %}
{% import_yaml "vault/maps/osfamilymap.yaml" or {} as osfamilymap %}
{% import_yaml "vault/maps/initfamilymap.yaml" or {} as initfamilymap %}

{%- set merged_defaults = salt.grains.filter_by(defaults,
    default='vault',
    merge=salt.grains.filter_by(osfamilymap, grain='os_family',
      merge=salt.grains.filter_by(initfamilymap, grain='init',
        merge=salt.grains.get('vault', default={})
      )
    )
) %}

{#- Merge the vault pillar #}
{%- set vault = salt.pillar.get('vault', default=merged_defaults, merge=True) %}
